

[负载均衡](https://so.csdn.net/so/search?q=%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1&spm=1001.2101.3001.7020)就是多进程分担压力。

## 负载均衡策略

举例：  
**随机**、**轮询**、**加权随机**、**加权轮询**、**一致性哈希**、**最小活跃度**、**最短响应时间**。

**加权随机**就是根据节点的权重划分区间，随机数落在哪个节点的区间，就决定是哪个节点，权重越大，区间越大，随机数落入的概率越大。

**加权轮询**，举个例子，节点权重1、2、3，来了6个请求，第一个请求由第一个节点负责，第二个和第三个请求由第二个节点负责，最后三个由第三个节点负责。

**一致性哈希**是哈希环，[TreeMap](https://so.csdn.net/so/search?q=TreeMap&spm=1001.2101.3001.7020)实现。每个节点的哈希值对大小环大小取模，放在哈希环上，以分片策略为例，来了ID，ID对应的哈希值也落在哈希环上，顺时针找到的一个节点，就是对应的节点。哈希环在增删节点时，只影响此节点和逆时针方向的第一个节点之间的ID，ID对应的数据的迁移量小于取模分片。  
**Redis**的**ShardedJedis**、**Mycat**的分片策略、**Dubbo**负载均衡中用到了一致性哈希。

**最小活跃度**，就是选择处理中的请求最少的节点。

**最短响应时间**，就是选择响应时间最短的节点。

## 应用

**Dubbo**用了加权随机、加权轮询、一致性哈希、最小活跃度、最短响应时间，默认随机，也就是权重相等的加权随机。

**Ribbon**用了随机、轮询，默认轮询。

**Redis**的**ShardedJedis**用了一致性哈希，**Redis**的**Group**用了哈希槽。

## 分层负载

**Nginx**、**Ribbon**、**Dubbo**、**Spring Cloud Load Balancer**控制Http，工作在应用层，是七层负载。

**LVS**控制TCP，工作在传输层，是四层负载。

**HAProxy**提供了四层负载和七层负载。**Keepalived**和**HAProxy**或**LVS**可用于搭建RabbitMQ、Mycat、MySQL集群。

控制IP，工作在网络层，是三层负载。

控制MAC地址，工作在数据链路层，是二层负载。